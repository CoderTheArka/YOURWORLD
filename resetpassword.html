<html>
<head>
    <title>YOUR WORLD</title>
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="resetpassword.css">
      
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.2/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>
    <script src="resetpassword.js"></script>
    <link rel="icon" href="download.jpg">


</head>
<body>
    <div class="mainDiv">
        <div class="cardStyle">
            
            <img src="" id="signupLogo"/>
            
            <h2 class="formTitle">
              Login to your account
            </h2>
            
            <div class="inputDiv">
                <label class="inputLabel">Name:</label>
                <input type="text" id="name" name="name" required>
              </div>

          <div class="inputDiv">
            <label class="inputLabel">New Password</label>
            <input type="password" id="password" name="password" required>
          </div>
            
          <div class="inputDiv">
            <label class="inputLabel">Confirm Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword">
          </div>
          
          <div class="buttonWrapper">
            <button type="submit" id="submitButton" class="submitButton pure-button pure-button-primary">
              <span >Continue</span>
            </button>
          </div>
            
        
        </div>
      </div>
</body>
<script type="module">
  // https://firebase.google.com/docs/web/setup#available-libraries
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
  import {  getDatabase, ref, set, onValue  } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";
  import { getStorage, ref as REF, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-storage.js";
  import { getFirestore, doc, getDoc, setDoc, collection, addDoc} from "https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js";
  // Your web app's Firebase configuration
  const firebaseConfig = {
  apiKey: "AIzaSyBQ7uPLr9i23Vva0yBzz3YQ4cgIywRRNmA",
  authDomain: "registration-310c5.firebaseapp.com",
  projectId: "registration-310c5",
  storageBucket: "registration-310c5.appspot.com",
  messagingSenderId: "98589376762",
  appId: "1:98589376762:web:a8eab52be264c69c020943"
};

const app = initializeApp(firebaseConfig);
  const database = getDatabase();
  const clouddb = getFirestore();


  submitButton.addEventListener('click' , (e)=>{

    var name55 = document.getElementById('name').value ;
    var password = document.getElementById('password').value ;
    var confirm_password = document.getElementById('confirmPassword').value ;

if(password == confirm_password){

  var name55 = document.getElementById('name').value ;
    var password = document.getElementById('password').value ;
    var confirm_password = document.getElementById('confirmPassword').value ;


    const starCountRef = ref(database, 'users/'+ name55+'/');
onValue(starCountRef, (snapshot) =>{
const data = snapshot.val();
var name55 = document.getElementById('name').value ;
    var password = document.getElementById('password').value ;
    var confirm_password = document.getElementById('confirmPassword').value ;

   if(data.username == name55){

    set(ref(database, 'users/' + name55 + '/'), {
    username: name55,
    email: localStorage.getItem('forgot_email'),
    password : password,

  }).then(() => {
  alert('PASSWORD HAS BEEN CHANGED');
  setTimeout(() => {window.location = 'index.html'; }, 5000)
})
.catch((error) => {
  alert(error);
});

   }else{
    alert("USER IS NOT IN OUR DATA.")
   }

});
 }else{
    alert("TWO PASSWORD DIDN'T MATCH");
    document.getElementById('confirmPassword').innerHTML = '';
    document.getElementById('password').innerHTML = '';
    document.getElementById('name').innerHTML = '';
 }
  });
   
 
</script>
</html>